[gd_scene load_steps=41 format=3 uid="uid://dddkdecg7d5jo"]

[sub_resource type="GDScript" id="GDScript_186t8"]
script/source = "# Player.gd

extends CharacterBody2D

# ... (export variables for speed, etc.)

@onready var anim_tree = $AnimationTree
@onready var lower_body_fsm = anim_tree.get(\"parameters/LowerBodyFSM/playback\")
@onready var upper_body_fsm = anim_tree.get(\"parameters/UpperBodyFSM/playback\")

func _physics_process(delta):
	# --- Handle Input and Movement ---
	var direction = Input.get_axis(\"ui_left\", \"ui_right\")
	velocity.x = direction * 10
	move_and_slide()

	# --- Update Animation Tree ---
	update_animation_parameters()

func update_animation_parameters():
	# --- Control the Lower Body State Machine ---

	if velocity.x == 0:
		lower_body_fsm.travel(\"Idle\")
	else:
		upper_body_fsm.travel(\"Shoot\")
			# Flip sprites based on direction
		$lower.flip_h = velocity.x < 0
		$upper.flip_h = velocity.x < 0
	# Add jump/fall animation logic here later

	# --- Control the Upper Body State Machine ---
	if Input.is_action_pressed(\"ui_page_down\"):
		upper_body_fsm.travel(\"Shoot\")
	else:
		# Only go back to idle if not already in idle
		# to avoid interrupting the shoot animation
		if upper_body_fsm.get_current_node() == \"Shoot\":
			upper_body_fsm.travel(\"Idle\")
"

[sub_resource type="CompressedTexture2D" id="CompressedTexture2D_f50pn"]
load_path = "res://.godot/imported/sword_sheathe_breathe-Sheet.png-6a4700bf2957efbf86d0cc2ae9877dc6.ctex"

[sub_resource type="CompressedTexture2D" id="CompressedTexture2D_ij6vw"]
load_path = "res://.godot/imported/sword_out-Sheet.png-76569fbc8ef5c25993793121d507f07a.ctex"

[sub_resource type="AnimationNodeAdd2" id="AnimationNodeAdd2_4sjlk"]

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_k85er"]
animation = &"Attack_lower"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_ebjds"]
animation = &"Idle_lower"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_y1dt5"]
animation = &"Stance_lower"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_au0nh"]
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_76bt2"]
advance_mode = 2
advance_condition = &"Stance_lower"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_sxias"]
advance_mode = 2
advance_condition = &"Idle_lower"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_ucfvk"]
advance_mode = 2
advance_condition = &"Attack_lower"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_2dyae"]
advance_mode = 2
advance_condition = &"Stance_lower"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_2u5n8"]
advance_mode = 2
advance_condition = &"Idle_lower"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_73nau"]
advance_mode = 2
advance_condition = &"Attack_lower"

[sub_resource type="AnimationNodeStateMachine" id="AnimationNodeStateMachine_wyqjk"]
states/Attack_lower/node = SubResource("AnimationNodeAnimation_k85er")
states/Attack_lower/position = Vector2(561, 225)
states/Idle_lower/node = SubResource("AnimationNodeAnimation_ebjds")
states/Idle_lower/position = Vector2(392, 147)
states/Stance_lower/node = SubResource("AnimationNodeAnimation_y1dt5")
states/Stance_lower/position = Vector2(561, 30)
transitions = ["Start", "Idle_lower", SubResource("AnimationNodeStateMachineTransition_au0nh"), "Idle_lower", "Stance_lower", SubResource("AnimationNodeStateMachineTransition_76bt2"), "Stance_lower", "Idle_lower", SubResource("AnimationNodeStateMachineTransition_sxias"), "Stance_lower", "Attack_lower", SubResource("AnimationNodeStateMachineTransition_ucfvk"), "Attack_lower", "Stance_lower", SubResource("AnimationNodeStateMachineTransition_2dyae"), "Attack_lower", "Idle_lower", SubResource("AnimationNodeStateMachineTransition_2u5n8"), "Idle_lower", "Attack_lower", SubResource("AnimationNodeStateMachineTransition_73nau")]

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_skrk8"]
animation = &"Attack_upper"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_ye16i"]
animation = &"Idle_upper"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_75u2t"]
animation = &"Stance_upper"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_7qa1u"]
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_8gu1l"]
advance_mode = 2
advance_condition = &"Attack_upper"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_jsgy1"]
advance_mode = 2
advance_condition = &"Idle_upper"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_el80s"]
advance_mode = 2
advance_condition = &"Stance_upper"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_oxcm1"]
advance_mode = 2
advance_condition = &"Idle_upper"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_ltww1"]
advance_mode = 2
advance_condition = &"Stance_upper"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_a7mna"]
advance_mode = 2
advance_condition = &"Attack_upper"

[sub_resource type="AnimationNodeStateMachine" id="AnimationNodeStateMachine_sxias"]
states/Attack_upper/node = SubResource("AnimationNodeAnimation_skrk8")
states/Attack_upper/position = Vector2(421, 59)
states/Idle_upper/node = SubResource("AnimationNodeAnimation_ye16i")
states/Idle_upper/position = Vector2(341, 184)
states/Stance_upper/node = SubResource("AnimationNodeAnimation_75u2t")
states/Stance_upper/position = Vector2(639, 283)
transitions = ["Start", "Idle_upper", SubResource("AnimationNodeStateMachineTransition_7qa1u"), "Idle_upper", "Attack_upper", SubResource("AnimationNodeStateMachineTransition_8gu1l"), "Attack_upper", "Idle_upper", SubResource("AnimationNodeStateMachineTransition_jsgy1"), "Idle_upper", "Stance_upper", SubResource("AnimationNodeStateMachineTransition_el80s"), "Stance_upper", "Idle_upper", SubResource("AnimationNodeStateMachineTransition_oxcm1"), "Attack_upper", "Stance_upper", SubResource("AnimationNodeStateMachineTransition_ltww1"), "Stance_upper", "Attack_upper", SubResource("AnimationNodeStateMachineTransition_a7mna")]
graph_offset = Vector2(-6, 16)

[sub_resource type="AnimationNodeBlendTree" id="AnimationNodeBlendTree_ucfvk"]
graph_offset = Vector2(-444.33673, 110.66861)
nodes/output/position = Vector2(680, 240)
nodes/Add2/node = SubResource("AnimationNodeAdd2_4sjlk")
nodes/Add2/position = Vector2(320, 140)
nodes/LowerBodyFSM/node = SubResource("AnimationNodeStateMachine_wyqjk")
nodes/LowerBodyFSM/position = Vector2(-280, 200)
nodes/UpperBodyFSM/node = SubResource("AnimationNodeStateMachine_sxias")
nodes/UpperBodyFSM/position = Vector2(0, 280)
node_connections = [&"output", 0, &"Add2", &"Add2", 0, &"LowerBodyFSM", &"Add2", 1, &"UpperBodyFSM"]

[sub_resource type="Animation" id="Animation_k3r5w"]
resource_name = "Attack_lower"
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("lower:texture")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [SubResource("CompressedTexture2D_ij6vw")]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("lower:hframes")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [6]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("lower:frame")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0, 0.2, 0.4, 0.6, 0.8, 1),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1),
"update": 1,
"values": [0, 1, 2, 3, 4, 5]
}
tracks/3/type = "value"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath("lower:scale")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(0.5, 0.5)]
}

[sub_resource type="CompressedTexture2D" id="CompressedTexture2D_ghijl"]
load_path = "res://.godot/imported/sword_out-Sheet(1)t.png-e6c209686ed848f1c32c5b089a6b429e.ctex"

[sub_resource type="Animation" id="Animation_73nau"]
resource_name = "Attack_upper"
length = 1.4
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("upper:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.2, 0.4, 0.6, 0.8, 1),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1),
"update": 1,
"values": [0, 1, 2, 3, 4, 5]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("upper:texture")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [SubResource("CompressedTexture2D_ghijl")]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("upper:hframes")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [6]
}
tracks/3/type = "value"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath("upper:scale")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(0.5, 0.5)]
}

[sub_resource type="CompressedTexture2D" id="CompressedTexture2D_44cfe"]
load_path = "res://.godot/imported/sword_out_breathe-Sheet.png-0f31c6dfcadacac66b7755a7b08b1c63.ctex"

[sub_resource type="Animation" id="Animation_1rslu"]
resource_name = "Idle_lower"
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("lower:texture")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [SubResource("CompressedTexture2D_44cfe")]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("lower:frame")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.2, 0.4),
"transitions": PackedFloat32Array(1, 1, 1),
"update": 1,
"values": [0, 1, 2]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("lower:hframes")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0.1),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [3]
}
tracks/3/type = "value"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath("lower:scale")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"times": PackedFloat32Array(0.1),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(1, 1)]
}

[sub_resource type="CompressedTexture2D" id="CompressedTexture2D_dd465"]
load_path = "res://.godot/imported/sword_out_breathe-Sheet(1).png-c73bb913439d27e7f30e3752934faf95.ctex"

[sub_resource type="Animation" id="Animation_2dyae"]
resource_name = "Idle_upper"
length = 0.6
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("upper:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.2, 0.4),
"transitions": PackedFloat32Array(1, 1, 1),
"update": 1,
"values": [2, 1, 2]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("upper:texture")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [SubResource("CompressedTexture2D_dd465")]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("upper:hframes")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [3]
}
tracks/3/type = "value"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath("upper:scale")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(1, 1)]
}

[sub_resource type="Animation" id="Animation_2u5n8"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("lower:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [0]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("upper:frame")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [0]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("lower:scale")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(1, 1)]
}

[sub_resource type="CompressedTexture2D" id="CompressedTexture2D_lhvu3"]
load_path = "res://.godot/imported/sword_sheathe_breathe-Sheet(1).png-f1c6d6b13c96f266816d7c3f7e5221dd.ctex"

[sub_resource type="Animation" id="Animation_lmwkj"]
resource_name = "Stance_lower"
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("lower:texture")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [SubResource("CompressedTexture2D_lhvu3")]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("lower:hframes")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [4]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("lower:frame")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0, 0.2, 0.4, 0.6),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 1,
"values": [0, 1, 2, 3]
}
tracks/3/type = "value"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath("lower:scale")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"times": PackedFloat32Array(0.0333333),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(1, 1)]
}

[sub_resource type="Animation" id="Animation_skrk8"]
resource_name = "Stance_upper"
length = 1.4
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("upper:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.2, 0.4, 0.6),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 1,
"values": [0, 1, 2, 3]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("upper:texture")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [SubResource("CompressedTexture2D_f50pn")]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("upper:scale")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(1, 1)]
}
tracks/3/type = "value"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath("upper:hframes")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [4]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_ye16i"]
_data = {
&"Attack_lower": SubResource("Animation_k3r5w"),
&"Attack_upper": SubResource("Animation_73nau"),
&"Idle_lower": SubResource("Animation_1rslu"),
&"Idle_upper": SubResource("Animation_2dyae"),
&"RESET": SubResource("Animation_2u5n8"),
&"Stance_lower": SubResource("Animation_lmwkj"),
&"Stance_upper": SubResource("Animation_skrk8")
}

[sub_resource type="RectangleShape2D" id="RectangleShape2D_75u2t"]
size = Vector2(125, 16)

[node name="CharacterBody2D" type="CharacterBody2D"]
script = SubResource("GDScript_186t8")

[node name="upper" type="Sprite2D" parent="."]
position = Vector2(241.5, 239.75)
texture = SubResource("CompressedTexture2D_f50pn")
hframes = 4

[node name="lower" type="Sprite2D" parent="."]
z_index = -1
position = Vector2(244, 235)
texture = SubResource("CompressedTexture2D_ij6vw")
hframes = 6

[node name="AnimationTree" type="AnimationTree" parent="."]
tree_root = SubResource("AnimationNodeBlendTree_ucfvk")
anim_player = NodePath("../AnimationPlayer")
parameters/Add2/add_amount = 1.0
parameters/LowerBodyFSM/conditions/Attack_lower = false
parameters/LowerBodyFSM/conditions/Idle_lower = false
parameters/LowerBodyFSM/conditions/Stance_lower = false
parameters/UpperBodyFSM/conditions/Attack_upper = false
parameters/UpperBodyFSM/conditions/Idle_upper = false
parameters/UpperBodyFSM/conditions/Stance_upper = false

[node name="AnimationPlayer" type="AnimationPlayer" parent="."]
libraries = {
&"": SubResource("AnimationLibrary_ye16i")
}

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
position = Vector2(-378, 158)
shape = SubResource("RectangleShape2D_75u2t")
